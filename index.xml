<?xml version="1.0" encoding="UTF-8"?>
<?asciidoc-toc maxdepth="4"?>
<book xmlns="http://docbook.org/ns/docbook" xmlns:xl="http://www.w3.org/1999/xlink" version="5.0" xml:lang="en">
<info>
<title>hazelcast-examples (0.0.1)</title>
<date>2019-04-07 00:35:38 UTC</date>
<author>
<personname>
<firstname>Maksim</firstname>
<surname>Kostromin</surname>
</personname>
<email>daggerok@gmail.com</email>
</author>
<authorinitials>MK</authorinitials>
<revhistory>
<revision>
<revnumber>0.0.1</revnumber>
<date>2019-04-07 00:35:38 UTC</date>
<authorinitials>MK</authorinitials>
</revision>
</revhistory>
</info>
<chapter xml:id="introduction">
<title>Introduction</title>
<formalpara>
<title>docker / docker-compose</title>
<para>
<programlisting language="bash" linenumbering="unnumbered">./mvnw</programlisting>
</para>
</formalpara>
<simpara>Resources:</simpara>
<itemizedlist>
<listitem>
<simpara><link xl:href="https://hazelcast.org/getting-started-with-hazelcast/">Hazelcast getting started</link></simpara>
</listitem>
</itemizedlist>
</chapter>
<chapter xml:id="implementation">
<title>Implementation</title>
<section xml:id="app">
<title>app</title>
<formalpara>
<title>build, run and test</title>
<para>
<programlisting language="bash" linenumbering="unnumbered">./mvnw clean install -f ./subzero-kryo-app/pom.xml
./subzero-kryo-app/subzero-kryo-app-backend/target/*.jar &amp;
http :8080 ololo=trololo
http :8080 hoho=oho
http :8080</programlisting>
</para>
</formalpara>
</section>
<section xml:id="pub-sub">
<title>pub-sub</title>
<formalpara>
<title>config</title>
<para>
<programlisting language="java" linenumbering="unnumbered">  public static final HazelcastInstance instance = createInstance();
  public static final HazelcastInstance client = createClient();</programlisting>
</para>
</formalpara>
<formalpara>
<title>publisher</title>
<para>
<programlisting language="java" linenumbering="unnumbered">    final String topicName = "domainEventsTopic";
    final HazelcastInstance client = Hz.client;
    final Function&lt;String, ITopic&lt;DomainEvent&gt;&gt; topic = client::getTopic;
    final Function&lt;String, DomainEvent&gt; data = message -&gt; DomainEvent
        .builder()
        .createdAt(LocalDateTime.now())
        .type(DomainEvent.Type.NONE)
        .jsonData(JSON.stringify(singletonMap("message", message)))
        .build();

    if (args.length &gt; 0) {
      final String message = String.join("", args);
      topic.apply(topicName)
           .publish(data.apply(message));
    }</programlisting>
</para>
</formalpara>
<formalpara>
<title>subscriber</title>
<para>
<programlisting language="java" linenumbering="unnumbered">@Slf4j
@Configuration
class PubSubHzCfg {
  @Bean(name = "hzInstance", destroyMethod = "shutdown")
  HazelcastInstance hzInstance() {
    return Hz.instance;
  }

  @Bean(name = "domainEventsTopic")
  ITopic&lt;DomainEvent&gt; domainEventsTopic(@Qualifier("hzInstance") final HazelcastInstance hzInstance) {
    return hzInstance.getTopic("domainEventsTopic");
  }

  @Bean
  ApplicationRunner applicationRunner(@Qualifier("domainEventsTopic") final ITopic&lt;DomainEvent&gt; domainEventsTopic) {
    return args -&gt; domainEventsTopic.addMessageListener(
        message -&gt; log.info("received message: {}",
                            message.getMessageObject(),
                            message.getPublishingMember(),
                            new Date(message.getPublishTime())));
  }
}</programlisting>
</para>
</formalpara>
</section>
<section xml:id="kryo-subzero">
<title>kryo (subzero)</title>
<formalpara>
<title>config</title>
<para>
<programlisting language="bash" linenumbering="unnumbered">  public static final Config config = createConfig();

  private static Config createConfig() {
    final Config config = new Config();
    SubZero.useAsGlobalSerializer(config);
    return config;
  }</programlisting>
</para>
</formalpara>
<formalpara>
<title>entity</title>
<para>
<programlisting language="bash" linenumbering="unnumbered">@Value
@Builder
@JsonIgnoreProperties(ignoreUnknown = true)
public class DomainEvent /* implements Serializable */ {
  public enum Type {
    NONE
  }

  // we don't need any serialization, because SubZero Kryo was added globally
  // // private static final long serialVersionUID = -3158689686565990234L;
  @JsonFormat(pattern = "yyyy-MM-dd'T'HH:mm:s")
  @JsonDeserialize(using = LocalDateTimeDeserializer.class)
  @JsonSerialize(using = LocalDateTimeSerializer.class)
  final LocalDateTime createdAt;
  final Type type;
  final String jsonData;
}</programlisting>
</para>
</formalpara>
<programlisting language="bash" linenumbering="unnumbered">./mvnw clean install -f ./subzero-kryo-app/pom.xml
./subzero-kryo-app/subzero-kryo-app-backend/target/*.jar &amp;
http :8080 ololo=trololo
http :8080 hoho=oho
http :8080</programlisting>
<simpara>Unresolved directive in index.adoc - include::../xml.adoc[tags=content]
Unresolved directive in index.adoc - include::../xml-sharing.adoc[tags=content]
Unresolved directive in index.adoc - include::../xml-async-pipeline.adoc[tags=content]</simpara>
<simpara>TODO: implement documentation&#8230;&#8203;</simpara>
</section>
</chapter>
<chapter xml:id="links">
<title>Links</title>
<itemizedlist>
<listitem>
<simpara><link xl:href="https://github.com/daggerok/hazelcast-examples">GitHub repo</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://daggerok.github.io/hazelcast-examples">GitHub pages</link></simpara>
</listitem>
</itemizedlist>
</chapter>
</book>